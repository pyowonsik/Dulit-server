// Dulit Database Schema
// 대한민국 대표 커플 메신저 - ERD

// Base Table (상속)
Table base_table {
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  version int [not null, default: 1]
}

// 사용자
Table user {
  id bigint [pk, increment]
  social_id varchar(255) [unique, not null]
  email varchar(255) [not null]
  social_provider varchar(50) [not null, default: 'common', note: 'kakao, naver, common']
  name varchar(255) [not null]
  password varchar(255)
  role varchar(50) [not null, default: 'user', note: 'admin, user']
  couple_id bigint [ref: > couple.id]
  created_at timestamp [not null]
  updated_at timestamp [not null]
  
  indexes {
    (social_id)
    (email)
    (couple_id)
  }
}

// 커플
Table couple {
  id bigint [pk, increment]
  created_at timestamp [not null]
  updated_at timestamp [not null]
  
  note: '두 사용자를 연결하는 커플 테이블'
}

// 채팅방
Table chat_room {
  id bigint [pk, increment]
  couple_id bigint [unique, ref: - couple.id, note: 'OneToOne 관계']
  created_at timestamp [not null]
  updated_at timestamp [not null]
  
  indexes {
    (couple_id)
  }
  
  note: '커플 전용 채팅방'
}

// 채팅방-사용자 연결 테이블 (ManyToMany)
Table chat_room_users {
  chat_room_id bigint [ref: > chat_room.id]
  user_id bigint [ref: > user.id]
  
  indexes {
    (chat_room_id, user_id) [pk]
  }
}

// 채팅 메시지
Table chat {
  id bigint [pk, increment]
  message text [not null]
  author_id bigint [ref: > user.id]
  chat_room_id bigint [ref: > chat_room.id]
  created_at timestamp [not null]
  updated_at timestamp [not null]
  
  indexes {
    (author_id)
    (chat_room_id)
    (created_at)
  }
  
  note: '실시간 채팅 메시지'
}

// 게시글
Table post {
  id bigint [pk, increment]
  title varchar(255) [not null]
  description text [not null]
  file_paths text[] [note: 'PostgreSQL 배열: 여러 이미지 경로']
  author_id bigint [ref: > user.id]
  couple_id bigint [ref: > couple.id]
  created_at timestamp [not null]
  updated_at timestamp [not null]
  
  indexes {
    (author_id)
    (couple_id)
    (created_at)
  }
  
  note: '데이트 코스 공유 게시글'
}

// 댓글
Table comment_model {
  id bigint [pk, increment]
  comment text [not null]
  author_id bigint [ref: > user.id]
  post_id bigint [ref: > post.id]
  created_at timestamp [not null]
  updated_at timestamp [not null]
  
  indexes {
    (author_id)
    (post_id)
  }
}

// 게시글 좋아요 (복합 기본키)
Table post_user_like {
  post_id bigint [ref: > post.id]
  user_id bigint [ref: > user.id]
  is_like boolean [not null]
  
  indexes {
    (post_id, user_id) [pk]
  }
  
  note: 'cascade delete 설정'
}

// 약속
Table plan {
  id bigint [pk, increment]
  topic varchar(255) [not null]
  location varchar(255) [not null]
  time timestamp [not null]
  couple_id bigint [ref: > couple.id]
  created_at timestamp [not null]
  updated_at timestamp [not null]
  
  indexes {
    (couple_id)
    (time)
  }
  
  note: '커플 약속 관리 (2시간 전 알림)'
}

// 기념일
Table anniversary {
  id bigint [pk, increment]
  title varchar(255) [not null]
  date date [not null]
  couple_id bigint [ref: > couple.id]
  created_at timestamp [not null]
  updated_at timestamp [not null]
  
  indexes {
    (couple_id)
    (date)
  }
  
  note: 'D-Day 자동 계산'
}

// 캘린더
Table calendar {
  id bigint [pk, increment]
  title varchar(255) [not null]
  description text [not null]
  date date [not null]
  file_paths text[] [note: 'PostgreSQL 배열: 여러 이미지 경로']
  couple_id bigint [ref: > couple.id]
  created_at timestamp [not null]
  updated_at timestamp [not null]
  
  indexes {
    (couple_id)
    (date)
  }
  
  note: '데이트 일정 기록'
}

